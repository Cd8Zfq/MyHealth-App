{% extends "base.html" %}

{% block title %}Nouvelle mesure{% endblock %}

{% block content %}
<div class="max-w-md mx-auto">
    <div class="flex items-center gap-4 mb-8">
        <a href="{{ url_for('main.select_measurement_method') }}" class="p-2 rounded-lg hover:bg-slate-100 text-slate-500 transition active:scale-95">
            <i data-lucide="arrow-left" class="w-5 h-5"></i>
        </a>
        <h1 class="text-xl font-bold text-slate-900">Saisie manuelle</h1>
    </div>

    <form method="POST" action="{{ url_for('main.add_measurement') }}" class="space-y-6">
        {{ form.hidden_tag() }}
        
        <div class="space-y-2">
            <label class="block text-sm font-semibold text-slate-700">Type de mesure</label>
            <div class="grid grid-cols-3 gap-3">
                {% for subfield in form.type %}
                <label class="cursor-pointer">
                    {{ subfield(class="peer sr-only") }}
                    <div class="h-full flex flex-col items-center justify-center gap-2 p-3 rounded-xl border border-slate-200 bg-white text-slate-500 peer-checked:border-primary peer-checked:bg-blue-50 peer-checked:text-primary transition hover:bg-blue-50 hover:border-blue-200 hover:text-primary active:scale-[0.98]">
                        {% if subfield.data == 'tension' %}<i data-lucide="heart" class="w-5 h-5"></i>
                        {% elif subfield.data == 'glycemie' %}<i data-lucide="candy" class="w-5 h-5"></i>
                        {% elif subfield.data == 'poids' %}<i data-lucide="scale" class="w-5 h-5"></i>
                        {% endif %}
                        <span class="text-xs font-semibold capitalize">{{ subfield.label.text }}</span>
                    </div>
                </label>
                {% endfor %}
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="space-y-2">
                <label id="label-val1" class="block text-sm font-semibold text-slate-700">Valeur 1</label>
                {{ form.value1(class="block w-full rounded-xl border-slate-200 shadow-sm focus:border-primary focus:ring-primary py-3 px-4 text-lg font-bold text-slate-900 placeholder:text-slate-300", placeholder="Ex: 120") }}
            </div>
            <div id="container-val2" class="space-y-2">
                <label id="label-val2" class="block text-sm font-semibold text-slate-700">Valeur 2 (Opt.)</label>
                {{ form.value2(class="block w-full rounded-xl border-slate-200 shadow-sm focus:border-primary focus:ring-primary py-3 px-4 text-lg font-bold text-slate-900 placeholder:text-slate-300", placeholder="Ex: 80") }}
            </div>
        </div>

        <div class="space-y-2">
            <label class="block text-sm font-semibold text-slate-700">Notes (Optionnel)</label>
            {{ form.notes(class="block w-full rounded-xl border-slate-200 shadow-sm focus:border-primary focus:ring-primary py-3 px-4 text-sm text-slate-900 placeholder:text-slate-400", rows="3", placeholder="Commentaire...") }}
        </div>

        <button type="submit" class="w-full bg-primary text-white font-semibold rounded-xl py-4 shadow-md shadow-blue-200 hover:bg-blue-700 transition active:scale-[0.98]">
            Enregistrer la mesure
        </button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const typeInputs = document.querySelectorAll('input[name="type"]');
        const labelVal1 = document.getElementById('label-val1');
        const labelVal2 = document.getElementById('label-val2');
        const containerVal2 = document.getElementById('container-val2');
        const inputVal1 = document.querySelector('input[name="value1"]');
        const inputVal2 = document.querySelector('input[name="value2"]');

        function updateForm(type) {
            if (type === 'tension') {
                labelVal1.textContent = 'Systolique (mmHg)';
                labelVal2.textContent = 'Diastolique (mmHg)';
                containerVal2.style.display = 'block';
                inputVal1.placeholder = '120';
                inputVal2.placeholder = '80';
            } else if (type === 'glycemie') {
                labelVal1.textContent = 'Glucose (mg/dL)';
                containerVal2.style.display = 'none';
                inputVal1.placeholder = '100';
            } else if (type === 'poids') {
                labelVal1.textContent = 'Poids (kg)';
                containerVal2.style.display = 'none';
                inputVal1.placeholder = '70.5';
            }
        }

        typeInputs.forEach(input => {
            input.addEventListener('change', (e) => updateForm(e.target.value));
            if (input.checked) {
                updateForm(input.value);
            }
        });
    });
</script>
{% endblock %}